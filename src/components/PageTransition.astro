<div
  class="no-scrollbar fixed inset-x-0 top-0 z-[1000] h-screen w-screen translate-y-full
    overflow-y-auto overscroll-contain bg-desk-black opacity-100 transition-all
    duration-500 ease-[cubic-bezier(0.25,0,0,1)]"
  id="page-transition-slider"
  transition:persist
>
</div>

<script>
  import { navigate } from "astro:transitions/client";

  const initPageTransition = () => {
    const pageSlide = document.getElementById("page-transition-slider");
    const desktopNav = document.querySelectorAll("#desktop-nav");
    const logoNav = document.getElementById("logo-nav");

    if (!pageSlide || !desktopNav.length || !logoNav) return;

    const toggleSlide = (isOpening) => {
      pageSlide.classList.toggle("translate-y-0", isOpening);
      pageSlide.classList.toggle("translate-y-full", !isOpening);
    };

    function handleNavClick(event) {
      event.preventDefault();
      const href = (event.target as HTMLElement).getAttribute("href");
      if (href.replace(/\/$/, "") === window.location.pathname.replace(/\/$/, "")) return;
      toggleSlide(true);

      const handleTransitionEnd = () => {
        setTimeout(() => {
          navigate(href).then(() => {
            document.addEventListener("astro:page-load", () => {
              toggleSlide(false);
            });
          });
        }, 500);

        pageSlide.removeEventListener("transitionend", handleTransitionEnd);
      };

      pageSlide.addEventListener("transitionend", handleTransitionEnd);
    }

    desktopNav.forEach((nav) => {
      nav.addEventListener("click", handleNavClick);
    });

    logoNav.addEventListener("click", handleNavClick);
  };

  initPageTransition();
  document.addEventListener("astro:page-load", initPageTransition);
</script>
